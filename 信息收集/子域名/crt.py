#!/usr/bin/env python3

import argparse
import re
import sys
import requests


def options():
    parser = argparse.ArgumentParser()
    # specify domain
    parser.add_argument(
        "--domain",
        help="Specify domain to search.",
        action="store",
    )
    # 如果没有参数，打印帮助信息
    if len(sys.argv[1:]) == 0:
        parser.print_help()
        parser.exit()
    args = parser.parse_args()
    return args


def useragent():
    user_agent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0"
    return user_agent


def crtsh():
    subdomains = set()
    domain = options().domain.replace("*", "%25")
    url = f"https://crt.sh/?q={domain}&output=json"

    try:
        response = requests.get(url, headers={'User-Agent': useragent()})
        regex = r'[^%*].*'
        data = response.json()
        if data:
            for row in data:
                row = re.findall(regex, row["name_value"])[0]
                subdomains.add(row)
            print("\n".join(subdomains))
        elif not data:
            print(f"[x] No data found for {options().domain} using crtsh.")
    except ValueError:
        pass


def main():
    crtsh()


if __name__ == "__main__":
    main()
